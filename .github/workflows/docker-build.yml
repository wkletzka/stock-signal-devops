#Every time you push code, GitHub automatically verifies that your app can still be built into a Docker image
#At the bottom: docker build -t NAME -f LOCATION_OF_DOCKERFILE BUILD_CONTENT (files docker can see during build)

name: Build Docker Image

on:
  push: 
    branches: [ "main" ]
    pull_request: 

jobs: 
  build: 
    runs-on: ubuntu-latest

    steps: 
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build Docker image
        run: |
          docker build -t stock-service -f services/market-data/Dockerfile services/market-data
          
      - name: Validate Kubernetes manifests
        run: |
          kubectl apply --dry-run=client -f k8s/dev/deployment.yaml
          kubectl apply --dry-run=client -f k8s/dev/service.yaml